<!DOCTYPE html>
<html lang='en'>
<head>
  <meta charset='UTF-8'>
  <title>Document</title>
</head>
<body>
  <div id='app'><div>
  <script src='bundle.js'></script>
</body>
</html>
const typeIndicator = {
  // String indicators
  string: Symbol(),
  readonlyString: Symbol(),
  optionalString: Symbol(),
  readonlyOptionalString: Symbol(),

  // Number indicators
  number: Symbol(),
  readonlyNumber: Symbol(),
  optionalNumber: Symbol(),
  readonlyOptionalNumber: Symbol(),

  // Boolean indicators
  boolean: Symbol(),
  readonlyBoolean: Symbol(),
  optionalBoolean: Symbol(),
  readonlyOptionalBoolean: Symbol(),

  // Complex indicators
  complex: Symbol(),
  readonlyComplex: Symbol(),
  optionalComplex: Symbol(),
  readonlyOptionalComplex: Symbol(),

  // Object indicators
  object: Symbol(),
  readonlyObject: Symbol(),
  optionalObject: Symbol(),
  readonlyOptionalObject: Symbol(),

  // Dictionary indicators
  dictionary: Symbol(),
  readonlyDictionary: Symbol(),
  optionalDictionary: Symbol(),
  readonlyOptionalDictionary: Symbol(),
}

function getComplexTypeConstructor(indicator) {
  return <ComplexType, SimpleType>(handle: {
    serialize: (complex: ComplexType) => SimpleType,
    deserialize: (simple: SimpleType) => ComplexType,
  }) => ( { indicator, handle } ) as any as ComplexType;
}

function getObjectTypeConstructor(indicator) {
  return function<T>(object: T) {
    return { indicator, object } as any as T;
  };
}

function getDictionaryTypeConstructor(indicator) {
  return function<T>(object: T) {
    return { indicator, object } as any as {
      [key: string]: T,
      [key: number]: T
    };
  };
}

const readonlyOptionalTypes = {
  string: typeIndicator.readonlyOptionalString as any as string,
  number: typeIndicator.readonlyOptionalNumber as any as number,
  boolean: typeIndicator.readonlyOptionalBoolean as any as boolean,
  complex: getComplexTypeConstructor(typeIndicator.readonlyOptionalComplex),
  object: getObjectTypeConstructor(typeIndicator.readonlyOptionalComplex),
  dictionary: getDictionaryTypeConstructor(typeIndicator.readonlyOptionalDictionary),
}

const T = {
  string: typeIndicator.string as any as string,
  number: typeIndicator.number as any as number,
  boolean: typeIndicator.boolean as any as boolean,
  complex: getComplexTypeConstructor(typeIndicator.complex),
  object: getObjectTypeConstructor(typeIndicator.object),
  dictionary: getDictionaryTypeConstructor(typeIndicator.dictionary),
  readonly: {
    string: typeIndicator.readonlyString as any as string,
    number: typeIndicator.readonlyNumber as any as number,
    boolean: typeIndicator.readonlyBoolean as any as boolean,
    complex: getComplexTypeConstructor(typeIndicator.readonlyComplex),
    object: getObjectTypeConstructor(typeIndicator.readonlyObject),
    dictionary: getDictionaryTypeConstructor(typeIndicator.readonlyDictionary),
    optional: readonlyOptionalTypes,
  },
  optional: {
    string: typeIndicator.optionalString as any as string,
    number: typeIndicator.optionalNumber as any as number,
    boolean: typeIndicator.optionalBoolean as any as boolean,
    complex: getComplexTypeConstructor(typeIndicator.optionalComplex),
    object: getObjectTypeConstructor(typeIndicator.optionalObject),
    dictionary: getDictionaryTypeConstructor(typeIndicator.optionalDictionary),
    readonly: readonlyOptionalTypes,
  }
}

function describe<T>(description: T) {
  console.log(description);
}

const User = describe({
  id: T.readonly.string,
  firstName: T.string,
  lastName: T.optional.string,
  dateOfBirth: T.optional.complex({
    serialize: (d: Date) => d.toUTCString(),
    deserialize: v => new Date(v),
  }),
  get name() {
    return this.firstName + ' ' + this.lastName
  }
})

const Message = describe({
  id: T.readonly.string,
  message: T.string,
  authorId: T.string,
})

const State = describe({
  users: T.dictionary(User),
  messages: T.dictionary(Message),
});

EmptyDefinition
.extendReadonlyProps({

})
.extend()
.extend()
